<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- icons -->
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet" />

	<!-- My CSS -->
	<link rel="stylesheet" href="../assets/css/manager.css">
	<link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/export_request.css">
	<link rel="stylesheet" href="../assets/css/swiper-bundle.min.css">

	<title>Export</title>
	<!-- JS -->
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.3.js"></script>
</head>
<body>
    <header class="header" id="header">
        <nav class="nav container">
            <a href="dashboard.html" class="nav__logo">
                <i class='bx bxl-medium-old'></i>MY WAREHOUSE
            </a>

            <div class="nav__btns">
                <!-- Theme change button -->
                <form action="" id="search-bar" class="search">
                    <input type="search" placeholder="Type something..." class="search__input">
                    <a href="#"><i class='bx bx-search'></i></a>
                </form>
                <i class='bx bx-moon change-theme' id="theme-button"></i>
                <!-- <div class="nav__shop" id="cart-shop">
                        <i class='bx bx-shopping-bag' ></i>
                    </div> -->
    
                <div class="nav__toggle" id="nav-toggle">
                    <i class='bx bx-grid-alt'></i>
                </div>
    
               <div class="nav__user" id="info-user">
					<a href="/manager/dashboard"><i class='bx bx-user'></i></a>
					<ul class="dropMenu">
						<li>
							<div
								style="display: flex; justify-content: center; align-items: center;">
								<img class="avt-dropMenu" src="assets/img/nike.png" alt="">
								<p th:text="${staff.getFirst_name()} + ' ' + ${staff.getLast_name()} "></p>
							</div>
							<p style="font-size: 14px; color: rgb(118, 113, 113);" th:text = "${staff.getRole().getRole_name()}"></p>
						</li>
						<li><img src="../assets/img/edit.png" alt=""> <a
							href="/profile">Edit Profile</a></li>
						<li><img src="../assets/img/logout.png" alt=""> <a
							style="color: rgb(242, 90, 90);" href="/home">Logout</a></li>
					</ul>
				</div>
            </div>
        </nav>
    </header>
    <!-- SIDEBAR -->
        <section id="sidebar">
		<ul class="side-menu top">			
			<li class="">
				<a href="/manager/dashboard" class="active">
					<img src="../assets/img/dashboard.png" alt="">
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li class="stockkeeper inspector" th:if="${role_id == 2}"><a href="/manager/product">
					<img src="../assets/img/sneakers.png" alt=""> <span
					class="text">Product</span>
			</a></li>
			<li class="sales_manager active" th:if="${role_id == 1} "><a
				href="/manager/ex_request"> <img
					src="../assets/img/sneakers_sale.png" alt=""> <span
					class="text">Product for sale</span>
			</a></li>
			<li class="stockkeeper sales_manager">
				<a href="/manager/request">
					<img src="../assets/img/request.png" alt="">

					<span class="text">Request</span>
				</a>
			</li>
			<li class="stockkeeper inspector sales_manager">
				<a href="/manager/order">
					<img src="../assets/img/oders.png" alt="">
					
					<span class="text">Orders</span>
				</a>
			</li>
			<li class="stockkeeper accountting">
				<a href="/manager/receipt">
					<img src="../assets/img/Delivery.png" alt="">
					<span class="text">Goods receipt</span>
				</a>
			</li>
			<li class="stockkeeper accountting">
				<a href="/manager/issue">
					<img src="../assets/img/transfer.png" alt="">
					<span class="text">Goods Issue</span>
				</a>
			</li>
			<li class="stockkeeper inspector">
				<a href="/manager/inventory">
					<img src="../assets/img/inventory.png" alt="">
					<span class="text">Inventory Report</span>
				</a>
			</li>
			<li class="stockkeeper accountting">
				<a href="/manager/invoice">
					<img src="../assets/img/invoice.png" alt="">
					<span class="text">Invoice</span>
				</a>
			</li>
			<li class="stockkeeper">
				<a href="/manager/staff">
					<img src="../assets/img/staff.png" alt="">
					<span class="text">Staff</span>
				</a>
			</li>
			<li class="sales_manager sales_staff">
				<a href="/manager/supplier">
					<img src="../assets/img/nike.png" alt="">
					<span class="text">Supplier</span>
				</a>
			</li>
			<li class="sales_manager sales_staff">
				<a href="/manager/store">
					<img src="../assets/img/store.png" alt="">
					<span class="text">Store</span>
				</a>
			</li>
		</ul>
	</section>
	<!-- SIDEBAR -->

	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			
			<a href="#" class="nav-link"><i class='bx bx-menu' ></i></a>
			<a href="#" class="btn-download">
				<i class='bx bxs-cloud-download' ></i>
				<span class="text">Download PDF</span>
			</a>
		</nav>
		<!-- NAVBAR -->

		<!-- MAIN -->
		<main>
            <div id ="main__productForSale">
                <div class="head-title">
                </div>
                <!-- <div class="dialog" id="confirmDialog_">
                    <div class="dialog-content">
                      <h2>Xác nhận xóa</h2>
                      <p>Bạn có chắc chắn muốn xóa thông tin sản phẩm</p><output id = "id_"></output>
                      <div class="dialog-buttons">
                        <button id="confirmBtn">Đồng ý</button>
                        <button id="cancelBtn">Hủy bỏ</button>
                      </div>
                    </div>
                </div>    -->
                <div class="table-data">
                    <div class="order">
                        <!-- <h1 class ="choose_product">Chọn sản phẩm</h1> -->
                        <div class="head">
                                <div>
                                    <form action="" id="search-bar" class="search">
                                        <input type="search" placeholder="Type something..." class="search__input">
                                        <a href="#"><i class='bx bx-search'></i></a>
                                    </form>
                                </div> 
                                 <div class="cr-btn" id="open-dia">
                       	 			<button>Create request</button>
                    			</div>
                            <!-- <a href="#" onclick="openDetail_ad()"><i class="lni lni-circle-plus"></i></a> -->
                        </div>
                    <table id = "table_select">
                   
                        <thead>
                            <tr>
                                <th><input class='' id ="checkedAll" type="checkbox"></th>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Image</th>
                                <!-- <th>Inventory Number</th> -->
                                <!-- <th>Category</th> -->
                                <th>Color</th>  
                                <th>Size</th>
                                <th>Price</th>
                                <th>Mfg</th> 
                                <th id="th_quantity">Quantity</th>
                            </tr>
                        </thead>
                        <tbody>
                                <tr class="productRequest" th:each = "product : ${listProduct}">
                                    <td class=""><input class='select-product' type="checkbox"></td>
                                    <td><p class="code" th:text = "${product.product_id}"></p></td>
                                    <td class="name" th:text = "${product.product_name}"></td>
                                    <td><img class="img_product" th:src="${product.img}"></td>
                                    <!-- <td><p>Life Style</p></td> -->
                                    <td>
                                        <p th:text = "${product.color}"></p>
                                    </td>
                                    <td>
                                        <p th:text = "${product.size}"></p>
                                    </td>
                                    <td><p class = "prc" th:text = "${product.price}"></p></td>
                                    <td><p th:text = "${product.mfg}"></p></t>
                                    <td class="quantity_request"><input class='quantityRe' type="number" min="0" value="1"></td>
                                    <!-- <td><span class="status completed">Completed</span></td> -->
                                </tr>
                               
                        </tbody>
                    </table>
                    
                </div>

            </div>
    
            </div>
        </main>
        <dialog id="dia-request">
            <div style="display: block;" class="request-content">
                <div class="head_request">
                    <div>
                        <h4><i class='bx bxl-medium-old'></i>  MY WAREHOUSE</h4>
                        <h5>Address: ABC, DEF, HG</h5>
                    </div>
                    <div>
                        <h5>SOCIALIST REPUBLIC OF VIETNAM</h5>
                        <h5>Independence - Freedom - Happiness</h5>
                    </div>
                </div>
                <h3 class="title">GOODS EXPORT REQUEST FORM</h3>
                <div class="info_request">
                    <div class = "detail_info">
                        <p>Dear: <input th:value = "${staff.staff_id}" type = "hidden" id = "staff_id"> <span th:text="${staff.getFirst_name()} + ' ' + ${staff.getLast_name()} "></span></p>
                        
                    </div>
                    
                    <div class = "detail_info">
                        <p>Position: <input th:value = "${staff.getRole().getRole_id()}" type = "hidden" id = "role_id"><span th:text = "${staff.getRole().getRole_name()}"></span> </p>
                        
                    </div>
                    <span>Supplier: </span> <span id = "nameSupplier"></span>       
                    <select style="font-size: 16px; padding: 3px 5px; border: none;" class="supp" id="suppSelect">
							<option value="0" th:text="Choose"></option>
							<option th:each="store : ${store}" name="store_id" id = "store_id"
								th:value="${store.store_id}" th:text="${store.store_name}"></option>
						</select>           
                    <div class = "detail_info">
                        <p>Reason:</p>
						<input type="text" id="reason" value="">
                    </div>
                </div>
                <div class="info_product">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Note</th>
                            </tr>
                        </thead>
                        <tbody id="listProductReq">
                        
                        </tbody>
                    </table>
                </div>
                <div class="sign_request">
                   <i><input class="dated" type="text" placeholder="Dated" th:value = "${date}"></i>
                    <br>
                    <div class="sign-area">
                        <div>
                            <span>Stock keeper</span>
                        </div>
                        <div>
                            <span>Sales manager</span>
                        </div>
                    </div>
                </div>
    
            </div>
            <div class="group-btn">
                <button class="submit" onclick = "sendProduct()">Send request</button>
                <button id="close-dia" value="cancel">Close</button>
                
            </div>
        </dialog>
    </section>
    <!--=============== SCROLL UP ===============-->
	 <a href="#" class="scrollup" id="scroll-up"> 
        <i class='bx bx-up-arrow-alt scrollup__icon' ></i>
    </a>

    <!--=============== SWIPER JS ===============-->
    <script src="../assets/js/swiper-bundle.min.js"></script>

    <!--=============== MAIN JS ===============-->
    <!-- <script src="assets/js/main.js"></script> -->
	<script src="../assets/js/theme.js"></script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/dialog.js"></script>
    
    <script>
		var selectElement = document.getElementById("suppSelect");
		var store_id;
   	 selectElement.addEventListener("change", function() {
        store_id = selectElement.value;
        // Làm gì đó với selectedValue
        console.log("Đã chọn giá trị: " + store_id);
    });
		function sendProduct() {
			var staff_id = document.querySelector('#staff_id').value;
			var reason = document.querySelector('#reason').value;					

			// Lấy thẻ <tbody> theo ID
			var requestDataList = [];
			// Lặp qua từng dòng (tr) trong tbody


		

			var productList = [];
			var rows = document.querySelectorAll("#listProductReq tr");

			rows.forEach(function (row) {
				var cells = row.querySelectorAll("td");
				if (cells.length === 5) {
					var id = cells[0].textContent.trim(); // Loại bỏ khoảng trắng và ký tự xuống dòng
					var name = cells[1].textContent.trim();
					var price = parseFloat(cells[2].textContent.trim());
					var quantity = parseInt(cells[3].textContent.trim());
					var note = cells[4].textContent.trim();

					var item = {
						product_id: id,
						product_name: name,
						price: price,
						quantity: quantity,
						note: note
					};
					productList.push(item);
				}
			});
			var requestData = {
        staff_id: staff_id,
        reason: reason,
        store_id: store_id,
        productList: productList
    };
	fetch('/manager/product/exportRequest', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData)
    })
    .then(response => response.text())
    .then(responseData => {
        // Xử lý phản hồi từ server
      	window.location.href = "/manager/product"; 
    });
    console.log(requestData);


		}
		
	</script>
	<script>
        const nameSupplier = document.getElementById("nameSupplier");
        
        function showSelected() {
                var select =  document.getElementById("suppSelect");
                var selectedOption = select.options[select.selectedIndex].text;
                 localStorage.setItem("selectedSupplier", selectedOption);
                nameSupplier.innerText = selectedOption;
                console.log(selectedOption);
            } 

        window.onload = function () {
                var selectedSupplier = localStorage.getItem("selectedSupplier");
                if (selectedSupplier) {
                    nameSupplier.innerText = selectedSupplier;
                }
            };
    </script>
</body>
</html>